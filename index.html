<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <meta name="viewport" content="width=device-width,height=device-height,inital-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black"/>
    <meta name="format-detection" content="telephone=no"/>
    <title>test</title>
    <link href="css/style.css" rel="stylesheet" type="text/css" />
</head>
<body>


<div class="body">
	<div id="scroBox" class="scroBox">
        <div class="scroCon">

            <div class="scroSec scroSecA">
                <div class="scroSecBox">
                    <div class="scroSecBg"></div>
                    <div class="scroSecCon">
                        <div class="aniItem animated bounceIn" style="width:100%; top:10%; left:0;">
                            <img src="img/logo.jpg" />
                        </div>
                    </div>
                </div>
            </div>

            <div class="scroSec scroSecB">
                <div class="scroSecBox">
                    <div class="scroSecBg"></div>
                    <div class="scroSecCon">
                        <div class="aniItem animated bounceInDown" style="width:100%; top:2%; left:0;">
                            <img src="img/logo.jpg" />
                        </div>
                        <div class="aniItem animated bounceInUp" style="width:100%; top:45%; left:0;">
                            <img src="img/logo.jpg" />
                        </div>
                    </div>
                </div>
            </div>

            <div class="scroSec scroSecC">
                <div class="scroSecBox">
                    <div class="scroSecBg"></div>
                    <div class="scroSecCon">
                        <div class="aniItem animated bounceInLeft" style="width:100%; top:2%; left:0;">
                            <img src="img/logo.jpg" />
                        </div>
                        <div class="aniItem animated bounceInRight" style="width:100%; top:45%; left:0;">
                            <img src="img/logo.jpg" />
                        </div>
                    </div>
                </div>
            </div>

            <div class="scroSec scroSecA">
                <div class="scroSecBox">
                    <div class="scroSecBg"></div>
                    <div class="scroSecCon">
                        <div class="aniItem animated fadeIn" style="width:100%; top:10%; left:0;">
                            <img src="img/logo.jpg" />
                        </div>
                    </div>
                </div>
            </div>

            <div class="scroSec scroSecB">
                <div class="scroSecBox">
                    <div class="scroSecBg"></div>
                    <div class="scroSecCon">
                        <div class="aniItem animated fadeInDown" style="width:100%; top:2%; left:0;">
                            <img src="img/logo.jpg" />
                        </div>
                        <div class="aniItem animated fadeInUp" style="width:100%; top:45%; left:0;">
                            <img src="img/logo.jpg" />
                        </div>
                    </div>
                </div>
            </div>

            <div class="scroSec scroSecA">
                <div class="scroSecBox">
                    <div class="scroSecBg"></div>
                    <div class="scroSecCon">
                        <div class="aniItem animated flipInX" style="width:100%; top:2%; left:0;">
                            <img src="img/logo.jpg" />
                        </div>
                        <div class="aniItem animated flipInY" style="width:100%; top:45%; left:0;">
                            <img src="img/logo.jpg" />
                        </div>
                    </div>
                </div>
            </div>

            <div class="scroSec scroSecB">
                <div class="scroSecBox">
                    <div class="scroSecBg"></div>
                    <div class="scroSecCon">
                        <div class="aniItem animated lightSpeedIn" style="width:100%; top:10%; left:0;">
                            <img src="img/logo.jpg" />
                        </div>
                    </div>
                </div>
            </div>

            <div class="scroSec scroSecC">
                <div class="scroSecBox">
                    <div class="scroSecBg"></div>
                    <div class="scroSecCon">
                        <div class="aniItem animated rotateIn" style="width:100%; top:10%; left:0;">
                            <img src="img/logo.jpg" />
                        </div>
                    </div>
                </div>
            </div>

            <div class="scroSec scroSecA">
                <div class="scroSecBox">
                    <div class="scroSecBg"></div>
                    <div class="scroSecCon">
                        <div class="aniItem animated rotateInDownLeft" style="width:100%; top:2%; left:0;">
                            <img src="img/logo.jpg" />
                        </div>
                        <div class="aniItem animated rotateInDownRight" style="width:100%; top:45%; left:0;">
                            <img src="img/logo.jpg" />
                        </div>
                    </div>
                </div>
            </div>

            <div class="scroSec scroSecB">
                <div class="scroSecBox">
                    <div class="scroSecBg"></div>
                    <div class="scroSecCon">
                        <div class="aniItem animated rollIn" style="width:100%; top:2%; left:0;">
                            <img src="img/logo.jpg" />
                        </div>
                        <div class="aniItem animated zoomIn" style="width:100%; top:45%; left:0;">
                            <img src="img/logo.jpg" />
                        </div>
                    </div>
                </div>
            </div>

            <div class="scroSec scroSecC">
                <div class="scroSecBox">
                    <div class="scroSecBg"></div>
                    <div class="scroSecCon">
                        <div class="aniItem animated zoomInDown" style="width:100%; top:2%; left:0;">
                            <img src="img/logo.jpg" />
                        </div>
                        <div class="aniItem animated zoomInUp" style="width:100%; top:45%; left:0;">
                            <img src="img/logo.jpg" />
                        </div>
                    </div>
                </div>
            </div>

            <div class="scroSec scroSecA">
                <div class="scroSecBox">
                    <div class="scroSecBg"></div>
                    <div class="scroSecCon">
                        <div class="aniItem animated zoomInLeft" style="width:100%; top:2%; left:0;">
                            <img src="img/logo.jpg" />
                        </div>
                        <div class="aniItem animated zoomInRight" style="width:100%; top:45%; left:0;">
                            <img src="img/logo.jpg" />
                        </div>
                    </div>
                </div>
            </div>

            <!--该模块会影响chrome浏览器手机调试器的touch监听-->
            <div class="scroSec scroSecC">
                <div class="scroSecBox">
                    <div class="scroSecBg"></div>
                    <div class="scroSecCon">
                        <div class="aniItem animated flip" style="width:100%; top:10%; left:0;">
                            <img src="img/logo.jpg" />
                        </div>
                    </div>
                </div>
            </div>

        </div>
	</div>

    <!--测试用开始-->
    <div class="dFixed" id="dFixed"></div>
    <!--测试用结束-->

</div>


<script>

    var cjmDom = {
        hasClass:function(obj,cls) {
            return obj.className.match(new RegExp('(\\s|^)' + cls + '(\\s|$)'));
        },
        addClass:function(obj,cls) {
            if(!cjmDom.hasClass(obj,cls) ) obj.className += " " + cls;
        },
        removeClass:function(obj,cls) {
            var reg = new RegExp('(\\s|^)' + cls + '(\\s|$)');
            if(obj.className.match(new RegExp('(\\s|^)' + cls + '\\s') ) ) {
                obj.className = obj.className.replace(reg, ' ');
            }else if(obj.className.match(new RegExp('(\\s|^)' + cls + '$') ) ) {
                obj.className = obj.className.replace(reg, '');
            }
        },
        transform:function(element,value,key) {
            key = key || "Transform";
            ["Moz", "O", "Ms", "Webkit", ""].forEach(function(prefix) {
                element.style[prefix + key] = value;
            });
            return element;
        }
    };

    function CjmSwip(oPara) {
        var _sel = this;
        _sel.oBox = document.querySelector("#"+oPara.sBoxId);
        _sel.oCon = document.querySelector("#"+oPara.sBoxId + " ." + oPara.sConClass);
        _sel.oItem = document.querySelectorAll("#"+oPara.sBoxId + " ." + oPara.sItemClass);
        _sel.sItemClassCur = oPara.sItemClassCur || oPara.sItemClass + "Cur";
        _sel.nIndexNow = oPara.nIndexNow || 0;
        _sel.nIndexLas = -1;
        _sel.nTouchTravel = oPara.touchTravel || 100;
        _sel.fCallFront = oPara.fCallFront;
        _sel.fCallBack = oPara.fCallBack;
        _sel.bLoop = oPara.bLoop || false;
        if(_sel.bLoop) {
            var oTemItemFir = _sel.oItem[0].cloneNode(true);
            var oTemItemLas = _sel.oItem[_sel.oItem.length-1].cloneNode(true);
            _sel.oCon.appendChild(oTemItemFir);
            _sel.oCon.insertBefore(oTemItemLas,_sel.oItem[0]);
            _sel.oItem = document.querySelectorAll("#"+oPara.sBoxId + " ." + oPara.sItemClass);
            _sel.nIndexNow += 1;
            if(typeof _sel.fCallBack !== "function") {
                _sel.fCallBack = _sel.fLoopFunc;
            }else{
                var fCallBackOld = _sel.fCallBack;
                _sel.fCallBack = function() {
                    fCallBackOld.call(_sel);
                    _sel.fLoopFunc();
                }
            }
        }
        _sel.nItemLen = _sel.oItem.length;
        _sel.oTouch = {bMoving:false,bTouchStar:false};

        cjmDom.addClass(_sel.oItem[_sel.nIndexNow],_sel.sItemClassCur);
        _sel.fInit(true);
        _sel.fListen();
        //调试
        //document.querySelector("#dFixed").innerHTML += document.querySelector(".bounceInImg").clientWidth;
    };
    CjmSwip.prototype = {
        fInit:function(bFirst) {
            var _sel = this;
            _sel.nScreenHeight = document.documentElement.clientHeight || document.body.clientHeight;
            for (var i=0; i<_sel.nItemLen; i++) {
                _sel.oItem[i].style.height = _sel.nScreenHeight + "px";
            };
            _sel.oCon.style.height = _sel.nScreenHeight*_sel.nItemLen + "px";
            if(_sel.nIndexNow != 0) {
                _sel.fMove(- _sel.nIndexNow * _sel.nScreenHeight);
                if(bFirst) {
                    if(typeof _sel.fCallBack === "function") {_sel.fCallBack();}
                }
            }
        },
        fListen:function() {
            var _sel = this;
            _sel.oCon.addEventListener("touchstart",function(e) {
                //document.querySelector("#dFixed").innerHTML += "<br />bMoving="+_sel.oTouch.bMoving;
                //e.preventDefault();//为了避免阻止input、textarea、a的浏览器默认行为，改为下面这句
                /^(?:INPUT|TEXTAREA|A)$/.test(e.target.tagName)||e.preventDefault();

                if(_sel.oTouch.bTouchStar || _sel.oTouch.bMoving) return;
                _sel.oTouch.bTouchStar = true;
                _sel.oTouch.nStart = e.touches[0].pageY;
                _sel.oTouch.nDistance = 0;
            },false);
            _sel.oCon.addEventListener("touchmove",function(e) {
                if(!_sel.oTouch.bTouchStar || _sel.oTouch.bMoving) return;
                _sel.oTouch.nDistance = e.touches[0].pageY - _sel.oTouch.nStart;
                _sel.fMove(- _sel.nIndexNow * _sel.nScreenHeight + _sel.oTouch.nDistance);
            },false);
            _sel.oCon.addEventListener("touchend",function(e) {
                if(!_sel.oTouch.bTouchStar || _sel.oTouch.bMovin) return;
                if(_sel.oTouch.nDistance == 0) {
                    _sel.oTouch.bTouchStar = false;
                    return;
                }
                if(_sel.oTouch.nDistance > _sel.nTouchTravel) {
                    if(_sel.nIndexNow > 0) {
                        _sel.nIndexLas = _sel.nIndexNow;
                        _sel.nIndexNow -= 1;
                    }
                }else if(_sel.oTouch.nDistance < -_sel.nTouchTravel) {
                    if(_sel.nIndexNow < (_sel.nItemLen -1) ) {
                        _sel.nIndexLas = _sel.nIndexNow;
                        _sel.nIndexNow += 1;
                    }
                }
                if(typeof _sel.fCallFront === "function") {_sel.fCallFront();}
                cjmDom.addClass(_sel.oCon,"moving");
                _sel.fMove(- _sel.nIndexNow * _sel.nScreenHeight);
                _sel.oTouch.bMoving = true;
                _sel.oTouch.bTouchStar = false;
            },false);
            _sel.oCon.addEventListener("webkitTransitionEnd",function() {
                cjmDom.removeClass(_sel.oCon,"moving");
                _sel.oTouch.bMoving = false;
                if(typeof _sel.fCallBack === "function") {_sel.fCallBack();}
                if(_sel.nIndexLas != -1) {
                    cjmDom.removeClass(_sel.oItem[_sel.nIndexLas],_sel.sItemClassCur);
                }
                if(!_sel.bLoop || (_sel.nIndexNow > 0 && _sel.nIndexNow < (_sel.nItemLen - 1) ) ) {
                    cjmDom.addClass(_sel.oItem[_sel.nIndexNow],_sel.sItemClassCur);
                }
            }, false);
            window.addEventListener("resize",function() {
                _sel.fInit();
            },false)
        },
        fMove:function(nNum) {
            var _sel = this;
            cjmDom.transform(_sel.oCon,"translateY("+ nNum +"px)");
        },
        fLoopFunc:function() {
            var _sel = this;
            if(_sel.nIndexNow > 0 && _sel.nIndexNow < (_sel.nItemLen -1) ) return;
            _sel.nIndexNow = _sel.nIndexNow == 0 ? _sel.nItemLen - 2 : 1;
            _sel.fMove(- _sel.nIndexNow * _sel.nScreenHeight);
        }
    };

    var oCjmSwip = new CjmSwip({
        sBoxId:"scroBox",
        sConClass:"scroCon",
        sItemClass:"scroSec",
        bLoop:true
    });

</script>

</body>
</html>




